# Описание проекта по классификации датасета CIFAR-10

## Структура проекта

```bash
.
├── .dvc
│   ├── .gitignore
│   └── config
├── cifar10
│   ├── .gitignore
│   ├── model.py
│   ├── train.py
│   ├── trainer.py
│   └── infer.py
├── conf
│   ├── config.yaml
│   ├── data_loading
│   │   └── data_loading.yaml
│   ├── model
│   │   └── model.yaml
│   ├── training
│   │   └── training.yaml
│   └── logging
│       └── logging.yaml
├── data
│   ├── .gitignore
│   ├── test.dvc
│   └── train.dvc
├── docs
│   ├── .gitignore
│   ├── conf.py
│   ├── index.rst
│   ├── make.bat
│   ├── Makefile
│   ├── model.rst
│   ├── modules.rst
│   └── trainer.rst
├── models
│   └── .gitignore
├── .gitignore
├── .dvcignore
├── .pre-commit-config.yaml
├── commands.py
├── docker-compose.yml
├── Dockerfile
├── LICENSE
├── poetry.lock
├── pyproject.toml
└── README.md

```

## Формулировка задачи

Основная цель заключается в исследовании новых технологий MLOps. Для этого была
выбрана модель для классификации изображений из датасета CIFAR-10. Целью проекта
является создание жизнеспособного пайплайна, способного автоматически
классифицировать изображения в один из указанных классов.

## Данные

Данные для проекта будут взяты из датасета CIFAR-10. Датасет содержит 60,000
изображений, каждое из которых имеет размер 32x32 пикселя. Изображения
представлены в цветном формате (RGB) и разбиты на 10 классов (птицы, автомобили,
лошади, собаки, кошки, самолет, грузовик, лягушки, цветы, и мотоциклы) по 6,000
изображений в каждом классе.

## Подход к моделированию

Для решения задачи используется такая архитектура нейронных сетей, как
**ResNet** - архитектура с остаточными связями, позволяющая строить глубокие
сети без проблем с исчезающими градиентами.

В качестве библиотек для реализации модели использованы:

- **Torch** - для построения моделей нейронных сетей.
- **Pytorch-Lightning** - для обучения моделей нейронных сетей.

Конфигурация решения включает:

- Загрузка и предобработка данных (нормализация, аугментация).
- Создание и компиляция модели (определение архитектуры, функции потерь и
  оптимизатора).
- Обучение модели на обучающей выборке и валидация на тестовой.
- Оценка качества модели с использованием метрик, таких как точность и
  кросс-энтропия.

Схема подхода к моделированию: [Загрузка данных] -> [Предобработка данных] ->
[Создание модели] -> [Обучение модели] -> [Оценка качества]

## Зависимости

Управление зависимостями осуществляется с помощью Poetry. Список зависимостей
хранится в файле `pyproject.toml`. Зависимости с точными версиями фиксируются в
файле `poetry.lock`. Чтобы получить дерево зависимостей, можно использовать
команду

```bash
poetry show --tree
```

## Quick start

Репозиторий содержит пакет Python с использованием `PyTorch Lightning`. Также
есть скрипты для обучения и инференса модели из командной строки и использования
Hydra:

- `cifar10` - package root;
- `cifar10.train` - script for train models;
- `cifar10.infer` - script for infer models;

В корне репозитория можно найти commands.py, это интерфейс CLI для шагов
обучения/инференса. Пакет может работать с конфигурациями Hydra, пример и
доступные параметры можно найти в каталоге configs.

#### Запуск обучения

Перед запуском в параллельном терминале необходимо запустить сервер mlflow:

```bash
mlflow server --host 127.0.0.1 --port 8080
```

После чего запустить обучение:

```bash
python commands.py train
```

#### Запуск инференса

```bash
python commands.py infer --checkpoint_name <имя_файла_контрольной_точки>
```

Все параметры можно найти в [conf](conf/).

Репозиторий использует DVC для контроля версий данных и сохранения моделей, в
примере используется S3-удаленный репозиторий (только для чтения), но это также
можно расширить.

Для логгирования используется логгер `lightning` - `MLFlowLogger` и утилиты
`MLflow` (см. [conf/logging](conf/logging))).

Таким образом, планируется создать полностью функциональную систему, которая
сможет обрабатывать изображения и классифицировать их в реальном времени, что
может быть полезно в различных областях.
